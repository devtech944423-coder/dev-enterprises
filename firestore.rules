rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // _categories collection: stores category metadata (collection names)
    // This collection lists all category collection names for automatic detection
    match /_categories/{document} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Category-based collections structure:
    // - Each category name (e.g., "Electronics", "Sweets") is a collection name
    // - Products are documents within those category collections
    // - Example: Electronics/product1, Electronics/product2, Sweets/product1
    
    // IMPORTANT: This rule allows public read access (no authentication required) to:
    // - Query collections (for category auto-detection)
    // - List/query documents in collections (for product listings)
    // - Read individual product documents
    // 
    // Write operations (create, update, delete) still require authentication
    // 
    // This pattern matches any collection name (category) and any document within it (product)
    match /{category}/{product} {
      // Allow all read operations: get, list, query - NO AUTHENTICATION REQUIRED
      allow read: if true;
      
      // Require authentication for writes (create, update, delete)
      allow write: if request.auth != null;
    }
  }
}

// TO APPLY THESE RULES:
// 1. Go to Firebase Console: https://console.firebase.google.com/
// 2. Select your project
// 3. Navigate to: Firestore Database â†’ Rules tab
// 4. Copy the rules above (from "rules_version" to the end)
// 5. Paste into the Rules editor
// 6. Click "Publish" to apply
// 
// After publishing, permission errors should be resolved and products will be visible without authentication.

